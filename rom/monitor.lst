 AS V1.42 Beta [Bld 295] - Source File monitor.asm - Page 1 - 12/10/2025 19:16:31


    1/   0 :                            ; monitor.asm - Intel 8080 Monitor ROM
    2/   0 :                            ; Assemble with: make
    3/   0 :                            ; 
    4/   0 :                            ; Memory Map:
    5/   0 :                            ;   0x0000-0x00FF: System workspace (RAM)
    6/   0 :                            ;   0x0100-0xEFFF: User program area (RAM)
    7/   0 :                            ;   0xF000-0xFFFF: Monitor ROM (this file)
    8/   0 :                            ;
    9/   0 :                            ; I/O Ports:
   10/   0 :                            ;   0x00: Console data out (write only)
   11/   0 :                            ;   0x01: Console data in (read only)
   12/   0 :                            ;   0x02: Console status (bit 0 = RX ready, bit 1 = TX ready)
   13/   0 :                            
   14/   0 :                                    CPU     8080
   15/F000 :                                    ORG     0F000H
   16/F000 :                            
   17/F000 :                            ; ============================================
   18/F000 :                            ; CONSTANTS
   19/F000 :                            ; ============================================
   20/F000 :                            
   21/F000 : =0H                        CONSOLE_DATA_OUT    EQU     00H
   22/F000 : =1H                        CONSOLE_DATA_IN     EQU     01H
   23/F000 : =2H                        CONSOLE_STATUS      EQU     02H
   24/F000 :                            
   25/F000 : =0F000H                    STACK_TOP       EQU     0F000H      ; Stack grows down from ROM
   26/F000 :                            
   27/F000 : =0DH                       CR              EQU     0DH
   28/F000 : =0AH                       LF              EQU     0AH
   29/F000 : =8H                        BS              EQU     08H
   30/F000 : =20H                       SPACE           EQU     20H
   31/F000 :                            
   32/F000 :                            ; ============================================
   33/F000 :                            ; WORKSPACE (RAM at 0x0080-0x00FF)
   34/F000 :                            ; ============================================
   35/F000 :                            
   36/F000 : =80H                       LINE_BUFFER     EQU     0080H       ; 80 bytes for command line
   37/F000 : =50H                       LINE_LENGTH     EQU     80          ; Max 80 chars
   38/F000 : =0D0H                      BUFFER_PTR      EQU     00D0H       ; Current position in buffer (2 bytes)
   39/F000 : =0D2H                      LAST_DUMP_ADDR  EQU     00D2H       ; Last dump address (2 bytes)
   40/F000 : =0D4H                      LAST_EXAM_ADDR  EQU     00D4H       ; Last examine address (2 bytes)
   41/F000 :                            
   42/F000 :                            ; ============================================
   43/F000 :                            ; COLD START
   44/F000 :                            ; ============================================
   45/F000 :                            
   46/F000 :                            COLD_START:
   47/F000 : 31 00 F0                           LXI     SP,STACK_TOP        ; Initialize stack pointer
   48/F003 :                                    
   49/F003 :                                    ; Initialize workspace
   50/F003 : 21 00 00                           LXI     H,0000H
   51/F006 : 22 D2 00                           SHLD    LAST_DUMP_ADDR      ; Default dump address = 0
   52/F009 : 22 D4 00                           SHLD    LAST_EXAM_ADDR      ; Default exam address = 0   
   53/F00C :                                    
   54/F00C : CD 6F F0                           CALL    PRINT_BANNER        ; Show startup message
   55/F00F :                                    
   56/F00F :                            ; ============================================
   57/F00F :                            ; MAIN LOOP
   58/F00F :                            ; ============================================
   59/F00F :                            
   60/F00F :                            MAIN_LOOP:
 AS V1.42 Beta [Bld 295] - Source File monitor.asm - Page 2 - 12/10/2025 19:16:31


   61/F00F : 3E 3E                              MVI     A,'>'               ; Print prompt
   62/F011 : CD 51 F0                           CALL    CONOUT
   63/F014 : 3E 20                              MVI     A,' '
   64/F016 : CD 51 F0                           CALL    CONOUT
   65/F019 :                                    
   66/F019 : CD B6 F0                           CALL    READ_LINE           ; Read command into LINE_BUFFER
   67/F01C :                                    
   68/F01C : 21 80 00                           LXI     H,LINE_BUFFER       ; Point to start of buffer
   69/F01F : CD 02 F1                           CALL    SKIP_SPACES         ; Skip leading spaces
   70/F022 :                                    
   71/F022 : 7E                                 MOV     A,M                 ; Get command character
   72/F023 : B7                                 ORA     A                   ; Empty line?
   73/F024 : CA 0F F0                           JZ      MAIN_LOOP           ; Yes, just prompt again
   74/F027 :                                    
   75/F027 :                                    ; Convert to uppercase if lowercase
   76/F027 : FE 61                              CPI     'a'
   77/F029 : DA 33 F0                           JC      NOT_LOWER
   78/F02C : FE 7B                              CPI     'z'+1
   79/F02E : D2 33 F0                           JNC     NOT_LOWER
   80/F031 : D6 20                              SUI     20H                 ; Convert to uppercase
   81/F033 :                            NOT_LOWER:
   82/F033 :                                    
   83/F033 : 23                                 INX     H                   ; Point past command char
   84/F034 :                                    
   85/F034 :                                    ; Command dispatch
   86/F034 : FE 44                              CPI     'D'
   87/F036 : CA 67 F1                           JZ      CMD_DUMP
   88/F039 : FE 45                              CPI     'E'
   89/F03B : CA 06 F2                           JZ      CMD_EXAMINE
   90/F03E : FE 47                              CPI     'G'
   91/F040 : CA 57 F2                           JZ      CMD_GO
   92/F043 : FE 3F                              CPI     '?'
   93/F045 : CA 63 F2                           JZ      CMD_HELP
   94/F048 :                                    
   95/F048 :                                    ; Unknown command
   96/F048 : 21 FC F2                           LXI     H,MSG_UNKNOWN
   97/F04B : CD 76 F0                           CALL    PRINT_STRING
   98/F04E : C3 0F F0                           JMP     MAIN_LOOP
   99/F051 :                            
  100/F051 :                            ; ============================================
  101/F051 :                            ; CONSOLE I/O ROUTINES
  102/F051 :                            ; ============================================
  103/F051 :                            
  104/F051 :                            ; CONOUT - Output character in A
  105/F051 :                            ; Preserves: all registers
  106/F051 :                            CONOUT:
  107/F051 : F5                                 PUSH    PSW
  108/F052 :                            CONOUT_WAIT:
  109/F052 : DB 02                              IN      CONSOLE_STATUS
  110/F054 : E6 02                              ANI     02H
  111/F056 : CA 52 F0                           JZ      CONOUT_WAIT
  112/F059 : F1                                 POP     PSW
  113/F05A : D3 00                              OUT     CONSOLE_DATA_OUT
  114/F05C : C9                                 RET
  115/F05D :                            
  116/F05D :                            ; CONIN - Input character to A
  117/F05D :                            ; Trashes: flags
  118/F05D :                            CONIN:
  119/F05D : DB 02                              IN      CONSOLE_STATUS
  120/F05F : E6 01                              ANI     01H
 AS V1.42 Beta [Bld 295] - Source File monitor.asm - Page 3 - 12/10/2025 19:16:31


  121/F061 : CA 5D F0                           JZ      CONIN
  122/F064 : DB 01                              IN      CONSOLE_DATA_IN
  123/F066 : C9                                 RET
  124/F067 :                            
  125/F067 :                            ; CONST - Console status
  126/F067 :                            ; Returns: A = 0xFF if char available, 0x00 if not
  127/F067 :                            ; Trashes: flags
  128/F067 :                            CONST:
  129/F067 : DB 02                              IN      CONSOLE_STATUS
  130/F069 : E6 01                              ANI     01H
  131/F06B : C8                                 RZ                          ; Return 0 if no char
  132/F06C : 3E FF                              MVI     A,0FFH              ; Return FF if char available
  133/F06E : C9                                 RET
  134/F06F :                            
  135/F06F :                            ; ============================================
  136/F06F :                            ; PRINT ROUTINES
  137/F06F :                            ; ============================================
  138/F06F :                            
  139/F06F :                            ; PRINT_BANNER - Display startup message
  140/F06F :                            PRINT_BANNER:
  141/F06F : 21 C2 F2                           LXI     H,MSG_BANNER
  142/F072 : CD 76 F0                           CALL    PRINT_STRING
  143/F075 : C9                                 RET
  144/F076 :                            
  145/F076 :                            ; PRINT_STRING - Print null-terminated string at HL
  146/F076 :                            ; Trashes: A, HL, flags
  147/F076 :                            PRINT_STRING:
  148/F076 : 7E                                 MOV     A,M                 ; Get character
  149/F077 : B7                                 ORA     A                   ; Check for null
  150/F078 : C8                                 RZ                          ; Return if end of string
  151/F079 : CD 51 F0                           CALL    CONOUT
  152/F07C : 23                                 INX     H
  153/F07D : C3 76 F0                           JMP     PRINT_STRING
  154/F080 :                            
  155/F080 :                            ; PRINT_CRLF - Print carriage return and line feed
  156/F080 :                            ; Trashes: A, flags
  157/F080 :                            PRINT_CRLF:
  158/F080 : 3E 0D                              MVI     A,CR
  159/F082 : CD 51 F0                           CALL    CONOUT
  160/F085 : 3E 0A                              MVI     A,LF
  161/F087 : CD 51 F0                           CALL    CONOUT
  162/F08A : C9                                 RET
  163/F08B :                            
  164/F08B :                            ; PRINT_SPACE - Print a space
  165/F08B :                            ; Trashes: A, flags
  166/F08B :                            PRINT_SPACE:
  167/F08B : 3E 20                              MVI     A,SPACE
  168/F08D : CD 51 F0                           CALL    CONOUT
  169/F090 : C9                                 RET
  170/F091 :                            
  171/F091 :                            ; PRINT_HEX_BYTE - Print A as two hex digits
  172/F091 :                            ; Input: A = byte to print
  173/F091 :                            ; Trashes: A, flags
  174/F091 :                            PRINT_HEX_BYTE:
  175/F091 : F5                                 PUSH    PSW                 ; Save original byte
  176/F092 : 0F                                 RRC                         ; Shift high nibble to low
  177/F093 : 0F                                 RRC
  178/F094 : 0F                                 RRC
  179/F095 : 0F                                 RRC
  180/F096 : CD 9E F0                           CALL    PRINT_HEX_NIBBLE    ; Print high nibble
 AS V1.42 Beta [Bld 295] - Source File monitor.asm - Page 4 - 12/10/2025 19:16:31


  181/F099 : F1                                 POP     PSW                 ; Restore original
  182/F09A : CD 9E F0                           CALL    PRINT_HEX_NIBBLE    ; Print low nibble
  183/F09D : C9                                 RET
  184/F09E :                            
  185/F09E :                            ; PRINT_HEX_NIBBLE - Print low nibble of A as hex digit
  186/F09E :                            ; Input: A = value (low 4 bits used)
  187/F09E :                            ; Trashes: A, flags
  188/F09E :                            PRINT_HEX_NIBBLE:
  189/F09E : E6 0F                              ANI     0FH                 ; Mask to low nibble
  190/F0A0 : FE 0A                              CPI     0AH                 ; Is it A-F?
  191/F0A2 : DA A7 F0                           JC      PHN_DIGIT           ; No, it's 0-9
  192/F0A5 : C6 07                              ADI     07H                 ; Adjust for A-F
  193/F0A7 :                            PHN_DIGIT:
  194/F0A7 : C6 30                              ADI     '0'                 ; Convert to ASCII
  195/F0A9 : CD 51 F0                           CALL    CONOUT
  196/F0AC : C9                                 RET
  197/F0AD :                            
  198/F0AD :                            ; PRINT_HEX_WORD - Print HL as four hex digits
  199/F0AD :                            ; Input: HL = word to print
  200/F0AD :                            ; Trashes: A, flags
  201/F0AD :                            PRINT_HEX_WORD:
  202/F0AD : 7C                                 MOV     A,H
  203/F0AE : CD 91 F0                           CALL    PRINT_HEX_BYTE
  204/F0B1 : 7D                                 MOV     A,L
  205/F0B2 : CD 91 F0                           CALL    PRINT_HEX_BYTE
  206/F0B5 : C9                                 RET
  207/F0B6 :                            
  208/F0B6 :                            ; ============================================
  209/F0B6 :                            ; INPUT ROUTINES
  210/F0B6 :                            ; ============================================
  211/F0B6 :                            
  212/F0B6 :                            ; READ_LINE - Read line into LINE_BUFFER
  213/F0B6 :                            ; Handles: BS (backspace), CR (end of line)
  214/F0B6 :                            ; Returns: LINE_BUFFER contains null-terminated string
  215/F0B6 :                            ; Trashes: A, B, C, HL, flags
  216/F0B6 :                            READ_LINE:
  217/F0B6 : 21 80 00                           LXI     H,LINE_BUFFER       ; Point to buffer start
  218/F0B9 : 06 00                              MVI     B,0                 ; Character count
  219/F0BB :                                    
  220/F0BB :                            RL_LOOP:
  221/F0BB : CD 5D F0                           CALL    CONIN               ; Get character
  222/F0BE : 4F                                 MOV     C,A                 ; Save it in C
  223/F0BF :                                    
  224/F0BF : FE 0D                              CPI     CR                  ; Enter pressed?
  225/F0C1 : CA FC F0                           JZ      RL_DONE
  226/F0C4 : FE 0A                              CPI     LF
  227/F0C6 : CA FC F0                           JZ      RL_DONE
  228/F0C9 :                                    
  229/F0C9 : FE 08                              CPI     BS                  ; Backspace?
  230/F0CB : CA E3 F0                           JZ      RL_BACKSPACE
  231/F0CE :                                    
  232/F0CE : FE 20                              CPI     SPACE               ; Ignore control chars
  233/F0D0 : DA BB F0                           JC      RL_LOOP
  234/F0D3 :                                    
  235/F0D3 :                                    ; Check buffer full
  236/F0D3 : 78                                 MOV     A,B
  237/F0D4 : FE 4F                              CPI     LINE_LENGTH-1       ; Room for char + null?
  238/F0D6 : D2 BB F0                           JNC     RL_LOOP             ; Buffer full, ignore
  239/F0D9 :                                    
  240/F0D9 :                                    ; Store and echo character
 AS V1.42 Beta [Bld 295] - Source File monitor.asm - Page 5 - 12/10/2025 19:16:31


  241/F0D9 : 71                                 MOV     M,C                 ; Store in buffer
  242/F0DA : 23                                 INX     H                   ; Advance pointer
  243/F0DB : 04                                 INR     B                   ; Increment count
  244/F0DC : 79                                 MOV     A,C                 ; Echo character
  245/F0DD : CD 51 F0                           CALL    CONOUT
  246/F0E0 : C3 BB F0                           JMP     RL_LOOP
  247/F0E3 :                                    
  248/F0E3 :                            RL_BACKSPACE:
  249/F0E3 : 78                                 MOV     A,B                 ; Check if buffer empty
  250/F0E4 : B7                                 ORA     A
  251/F0E5 : CA BB F0                           JZ      RL_LOOP             ; Nothing to delete
  252/F0E8 :                                    
  253/F0E8 : 2B                                 DCX     H                   ; Back up pointer
  254/F0E9 : 05                                 DCR     B                   ; Decrement count
  255/F0EA :                                    
  256/F0EA :                                    ; Erase character on screen: BS, space, BS
  257/F0EA : 3E 08                              MVI     A,BS
  258/F0EC : CD 51 F0                           CALL    CONOUT
  259/F0EF : 3E 20                              MVI     A,SPACE
  260/F0F1 : CD 51 F0                           CALL    CONOUT
  261/F0F4 : 3E 08                              MVI     A,BS
  262/F0F6 : CD 51 F0                           CALL    CONOUT
  263/F0F9 : C3 BB F0                           JMP     RL_LOOP
  264/F0FC :                                    
  265/F0FC :                            RL_DONE:
  266/F0FC : 36 00                              MVI     M,0                 ; Null terminate
  267/F0FE : CD 80 F0                           CALL    PRINT_CRLF          ; Echo newline
  268/F101 : C9                                 RET
  269/F102 :                            
  270/F102 :                            ; ============================================
  271/F102 :                            ; PARSING ROUTINES
  272/F102 :                            ; ============================================
  273/F102 :                            
  274/F102 :                            ; SKIP_SPACES - Skip spaces in buffer
  275/F102 :                            ; Input: HL = pointer into buffer
  276/F102 :                            ; Output: HL = pointer to first non-space (or null)
  277/F102 :                            ; Trashes: A, flags
  278/F102 :                            SKIP_SPACES:
  279/F102 : 7E                                 MOV     A,M
  280/F103 : FE 20                              CPI     SPACE
  281/F105 : C0                                 RNZ                         ; Return if not a space
  282/F106 : 23                                 INX     H
  283/F107 : C3 02 F1                           JMP     SKIP_SPACES
  284/F10A :                            
  285/F10A :                            ; READ_HEX_WORD - Parse hex number from buffer
  286/F10A :                            ; Input: HL = pointer into buffer
  287/F10A :                            ; Output: DE = parsed value, HL = advanced past number
  288/F10A :                            ;         Carry set if no valid hex digits found
  289/F10A :                            ; Trashes: A, BC, flags
  290/F10A :                            READ_HEX_WORD:
  291/F10A : CD 02 F1                           CALL    SKIP_SPACES         ; Skip leading spaces
  292/F10D : 11 00 00                           LXI     D,0                 ; Initialize result
  293/F110 : 06 00                              MVI     B,0                 ; Digit count
  294/F112 :                                    
  295/F112 :                            RHW_LOOP:
  296/F112 : 7E                                 MOV     A,M                 ; Get character
  297/F113 : CD 3D F1                           CALL    TO_HEX_DIGIT        ; Convert to 0-15
  298/F116 : DA 37 F1                           JC      RHW_DONE            ; Not a hex digit, done
  299/F119 :                                    
  300/F119 :                                    ; Shift DE left 4 bits and add new digit
 AS V1.42 Beta [Bld 295] - Source File monitor.asm - Page 6 - 12/10/2025 19:16:31


  301/F119 :                                    ; DE = DE * 16 + A
  302/F119 : F5                                 PUSH    PSW                 ; Save digit
  303/F11A :                                    
  304/F11A :                                    ; Get E's high nibble (will go to D's low nibble)
  305/F11A : 7B                                 MOV     A,E
  306/F11B : E6 F0                              ANI     0F0H                ; Isolate high nibble
  307/F11D : 0F                                 RRC
  308/F11E : 0F                                 RRC
  309/F11F : 0F                                 RRC
  310/F120 : 0F                                 RRC                         ; Move to low nibble position
  311/F121 : 4F                                 MOV     C,A                 ; Save it
  312/F122 :                                    
  313/F122 :                                    ; Shift D left 4 bits
  314/F122 : 7A                                 MOV     A,D
  315/F123 : 87                                 ADD     A
  316/F124 : 87                                 ADD     A
  317/F125 : 87                                 ADD     A
  318/F126 : 87                                 ADD     A                   ; D << 4
  319/F127 : B1                                 ORA     C                   ; OR in E's high nibble
  320/F128 : 57                                 MOV     D,A
  321/F129 :                                    
  322/F129 :                                    ; Shift E left 4 bits
  323/F129 : 7B                                 MOV     A,E
  324/F12A : 87                                 ADD     A
  325/F12B : 87                                 ADD     A
  326/F12C : 87                                 ADD     A
  327/F12D : 87                                 ADD     A                   ; E << 4
  328/F12E : 5F                                 MOV     E,A
  329/F12F :                                    
  330/F12F :                                    ; Add new digit
  331/F12F : F1                                 POP     PSW
  332/F130 : B3                                 ORA     E
  333/F131 : 5F                                 MOV     E,A
  334/F132 :                                    
  335/F132 : 23                                 INX     H                   ; Advance buffer pointer
  336/F133 : 04                                 INR     B                   ; Count digit
  337/F134 : C3 12 F1                           JMP     RHW_LOOP
  338/F137 :                                    
  339/F137 :                            RHW_DONE:
  340/F137 : 78                                 MOV     A,B                 ; Check digit count
  341/F138 : B7                                 ORA     A
  342/F139 : 37                                 STC                         ; Set carry (no digits)
  343/F13A : C8                                 RZ                          ; Return with carry if no digits
  344/F13B : B7                                 ORA     A                   ; Clear carry (success)
  345/F13C : C9                                 RET
  346/F13D :                            
  347/F13D :                            ; TO_HEX_DIGIT - Convert ASCII to hex value
  348/F13D :                            ; Input: A = ASCII character
  349/F13D :                            ; Output: A = hex value (0-15), Carry clear
  350/F13D :                            ;         Carry set if not a hex digit
  351/F13D :                            ; Trashes: flags
  352/F13D :                            TO_HEX_DIGIT:
  353/F13D : FE 30                              CPI     '0'
  354/F13F : DA 65 F1                           JC      THD_FAIL            ; Below '0'
  355/F142 : FE 3A                              CPI     '9'+1
  356/F144 : DA 61 F1                           JC      THD_DIGIT           ; '0'-'9'
  357/F147 :                                    
  358/F147 : FE 41                              CPI     'A'
  359/F149 : DA 65 F1                           JC      THD_FAIL            ; Between '9' and 'A'
  360/F14C : FE 47                              CPI     'F'+1
 AS V1.42 Beta [Bld 295] - Source File monitor.asm - Page 7 - 12/10/2025 19:16:31


  361/F14E : DA 5D F1                           JC      THD_ALPHA           ; 'A'-'F'
  362/F151 :                                    
  363/F151 : FE 61                              CPI     'a'
  364/F153 : DA 65 F1                           JC      THD_FAIL            ; Between 'F' and 'a'
  365/F156 : FE 67                              CPI     'f'+1
  366/F158 : D2 65 F1                           JNC     THD_FAIL            ; Above 'f'
  367/F15B :                                    
  368/F15B :                                    ; 'a'-'f': convert to uppercase first
  369/F15B : D6 20                              SUI     20H
  370/F15D :                                    
  371/F15D :                            THD_ALPHA:
  372/F15D : D6 37                              SUI     'A'-10              ; Convert 'A'-'F' to 10-15
  373/F15F : B7                                 ORA     A                   ; Clear carry
  374/F160 : C9                                 RET
  375/F161 :                                    
  376/F161 :                            THD_DIGIT:
  377/F161 : D6 30                              SUI     '0'                 ; Convert '0'-'9' to 0-9
  378/F163 : B7                                 ORA     A                   ; Clear carry
  379/F164 : C9                                 RET
  380/F165 :                                    
  381/F165 :                            THD_FAIL:
  382/F165 : 37                                 STC                         ; Set carry = not hex
  383/F166 : C9                                 RET
  384/F167 :                            
  385/F167 :                            ; ============================================
  386/F167 :                            ; COMMANDS
  387/F167 :                            ; ============================================
  388/F167 :                            
  389/F167 :                            ; CMD_DUMP - Dump memory
  390/F167 :                            ; Syntax: D [start] [end]
  391/F167 :                            ; If no args, continues from last address
  392/F167 :                            ; If one arg, dumps 128 bytes from start
  393/F167 :                            ; If two args, dumps from start to end
  394/F167 :                            CMD_DUMP:
  395/F167 : CD 02 F1                           CALL    SKIP_SPACES
  396/F16A : 7E                                 MOV     A,M
  397/F16B : B7                                 ORA     A                   ; End of line?
  398/F16C : CA 88 F1                           JZ      CD_NO_ARGS
  399/F16F :                                    
  400/F16F :                                    ; Parse start address
  401/F16F : CD 0A F1                           CALL    READ_HEX_WORD
  402/F172 : DA A2 F1                           JC      CD_ERROR            ; No valid address
  403/F175 : D5                                 PUSH    D                   ; Save start address
  404/F176 :                                    
  405/F176 : CD 02 F1                           CALL    SKIP_SPACES
  406/F179 : 7E                                 MOV     A,M
  407/F17A : B7                                 ORA     A                   ; End of line?
  408/F17B : CA 96 F1                           JZ      CD_ONE_ARG
  409/F17E :                                    
  410/F17E :                                    ; Parse end address
  411/F17E : CD 0A F1                           CALL    READ_HEX_WORD
  412/F181 : DA A1 F1                           JC      CD_POP_ERROR        ; Invalid end address
  413/F184 :                                    
  414/F184 :                                    ; Two args: start in stack, end in DE
  415/F184 : E1                                 POP     H                   ; HL = start
  416/F185 : C3 AB F1                           JMP     CD_DUMP_RANGE
  417/F188 :                                    
  418/F188 :                            CD_NO_ARGS:
  419/F188 :                                    ; Continue from last address
  420/F188 : 2A D2 00                           LHLD    LAST_DUMP_ADDR
 AS V1.42 Beta [Bld 295] - Source File monitor.asm - Page 8 - 12/10/2025 19:16:31


  421/F18B : 11 7F 00                           LXI     D,007FH             ; 128 bytes
  422/F18E : 19                                 DAD     D                   ; HL = start + 127 = end
  423/F18F : EB                                 XCHG                        ; DE = end
  424/F190 : 2A D2 00                           LHLD    LAST_DUMP_ADDR      ; HL = start
  425/F193 : C3 AB F1                           JMP     CD_DUMP_RANGE
  426/F196 :                                    
  427/F196 :                            CD_ONE_ARG:
  428/F196 : E1                                 POP     H                   ; HL = start
  429/F197 : E5                                 PUSH    H                   ; Save start again
  430/F198 : 11 7F 00                           LXI     D,007FH
  431/F19B : 19                                 DAD     D                   ; HL = start + 127 = end
  432/F19C : EB                                 XCHG                        ; DE = end
  433/F19D : E1                                 POP     H                   ; HL = start
  434/F19E : C3 AB F1                           JMP     CD_DUMP_RANGE
  435/F1A1 :                                    
  436/F1A1 :                            CD_POP_ERROR:
  437/F1A1 : D1                                 POP     D                   ; Clean up stack
  438/F1A2 :                            CD_ERROR:
  439/F1A2 : 21 20 F3                           LXI     H,MSG_BAD_ADDR
  440/F1A5 : CD 76 F0                           CALL    PRINT_STRING
  441/F1A8 : C3 0F F0                           JMP     MAIN_LOOP
  442/F1AB :                            
  443/F1AB :                            ; CD_DUMP_RANGE - Dump memory from HL to DE
  444/F1AB :                            ; Input: HL = start address, DE = end address
  445/F1AB :                            CD_DUMP_RANGE:
  446/F1AB : D5                                 PUSH    D                   ; Save end address
  447/F1AC :                            
  448/F1AC :                            CD_LINE:
  449/F1AC :                                    ; Print address
  450/F1AC : CD AD F0                           CALL    PRINT_HEX_WORD
  451/F1AF : 3E 3A                              MVI     A,':'
  452/F1B1 : CD 51 F0                           CALL    CONOUT
  453/F1B4 : CD 8B F0                           CALL    PRINT_SPACE
  454/F1B7 :                                    
  455/F1B7 :                                    ; Print 16 hex bytes
  456/F1B7 : E5                                 PUSH    H                   ; Save line start for ASCII
  457/F1B8 : 0E 10                              MVI     C,16                ; Byte counter
  458/F1BA :                                    
  459/F1BA :                            CD_HEX_BYTE:
  460/F1BA : 7E                                 MOV     A,M                 ; Get byte
  461/F1BB : CD 91 F0                           CALL    PRINT_HEX_BYTE
  462/F1BE : CD 8B F0                           CALL    PRINT_SPACE
  463/F1C1 :                                    
  464/F1C1 :                                    ; Extra space after 8th byte
  465/F1C1 : 79                                 MOV     A,C
  466/F1C2 : FE 09                              CPI     9
  467/F1C4 : C2 CA F1                           JNZ     CD_NO_GAP
  468/F1C7 : CD 8B F0                           CALL    PRINT_SPACE
  469/F1CA :                            CD_NO_GAP:
  470/F1CA :                                    
  471/F1CA : 23                                 INX     H
  472/F1CB : 0D                                 DCR     C
  473/F1CC : C2 BA F1                           JNZ     CD_HEX_BYTE
  474/F1CF :                                    
  475/F1CF :                                    ; Print ASCII representation
  476/F1CF : CD 8B F0                           CALL    PRINT_SPACE
  477/F1D2 : E1                                 POP     H                   ; Restore line start
  478/F1D3 : 0E 10                              MVI     C,16
  479/F1D5 :                                    
  480/F1D5 :                            CD_ASCII:
 AS V1.42 Beta [Bld 295] - Source File monitor.asm - Page 9 - 12/10/2025 19:16:31


  481/F1D5 : 7E                                 MOV     A,M
  482/F1D6 : FE 20                              CPI     SPACE               ; Printable? (>= 0x20)
  483/F1D8 : DA E0 F1                           JC      CD_DOT
  484/F1DB : FE 7F                              CPI     07FH                ; Printable? (< 0x7F)
  485/F1DD : DA E2 F1                           JC      CD_PRINT_CHAR
  486/F1E0 :                            CD_DOT:
  487/F1E0 : 3E 2E                              MVI     A,'.'
  488/F1E2 :                            CD_PRINT_CHAR:
  489/F1E2 : CD 51 F0                           CALL    CONOUT
  490/F1E5 : 23                                 INX     H
  491/F1E6 : 0D                                 DCR     C
  492/F1E7 : C2 D5 F1                           JNZ     CD_ASCII
  493/F1EA :                                    
  494/F1EA : CD 80 F0                           CALL    PRINT_CRLF
  495/F1ED :                                    
  496/F1ED :                                    ; Check if done (HL > end address)
  497/F1ED : D1                                 POP     D                   ; DE = end address
  498/F1EE : D5                                 PUSH    D                   ; Keep it on stack
  499/F1EF :                                    
  500/F1EF :                                    ; Compare HL to DE: if HL > DE, we're done
  501/F1EF : 7A                                 MOV     A,D
  502/F1F0 : BC                                 CMP     H
  503/F1F1 : DA FF F1                           JC      CD_DONE             ; D < H, done
  504/F1F4 : C2 AC F1                           JNZ     CD_LINE             ; D > H, continue
  505/F1F7 : 7B                                 MOV     A,E
  506/F1F8 : BD                                 CMP     L
  507/F1F9 : DA FF F1                           JC      CD_DONE             ; E < L, done (D == H)
  508/F1FC : C3 AC F1                           JMP     CD_LINE             ; E >= L, continue
  509/F1FF :                                    
  510/F1FF :                            CD_DONE:
  511/F1FF : D1                                 POP     D                   ; Clean up stack
  512/F200 : 22 D2 00                           SHLD    LAST_DUMP_ADDR      ; Save for next time
  513/F203 : C3 0F F0                           JMP     MAIN_LOOP
  514/F206 :                            
  515/F206 :                            ; CMD_EXAMINE - Examine/modify memory
  516/F206 :                            ; Syntax: E [addr]
  517/F206 :                            ; Shows "ADDR: XX-" and waits for input
  518/F206 :                            ; Enter hex to modify, CR to advance, period to exit
  519/F206 :                            CMD_EXAMINE:
  520/F206 : CD 02 F1                           CALL    SKIP_SPACES
  521/F209 : 7E                                 MOV     A,M
  522/F20A : B7                                 ORA     A                   ; Any address given?
  523/F20B : CA 18 F2                           JZ      CE_USE_LAST
  524/F20E :                                    
  525/F20E : CD 0A F1                           CALL    READ_HEX_WORD       ; Parse address into DE
  526/F211 : DA 4E F2                           JC      CE_ERROR            ; Invalid hex
  527/F214 : EB                                 XCHG                        ; HL = address to examine
  528/F215 : C3 1B F2                           JMP     CE_LOOP
  529/F218 :                                    
  530/F218 :                            CE_USE_LAST:
  531/F218 : 2A D4 00                           LHLD    LAST_EXAM_ADDR
  532/F21B :                                    
  533/F21B :                            CE_LOOP:
  534/F21B : CD AD F0                           CALL    PRINT_HEX_WORD      ; Print address
  535/F21E : 3E 3A                              MVI     A,':'
  536/F220 : CD 51 F0                           CALL    CONOUT
  537/F223 : 3E 20                              MVI     A,' '
  538/F225 : CD 51 F0                           CALL    CONOUT
  539/F228 : 7E                                 MOV     A,M                 ; Get current byte
  540/F229 : CD 91 F0                           CALL    PRINT_HEX_BYTE
 AS V1.42 Beta [Bld 295] - Source File monitor.asm - Page 10 - 12/10/2025 19:16:31


  541/F22C : 3E 2D                              MVI     A,'-'
  542/F22E : CD 51 F0                           CALL    CONOUT
  543/F231 :                                    
  544/F231 : CD 6C F2                           CALL    READ_EXAM_BYTE      ; Get user input
  545/F234 : DA 45 F2                           JC      CE_EXIT             ; Carry = exit requested
  546/F237 : 78                                 MOV     A,B                 ; Check digit count
  547/F238 : B7                                 ORA     A
  548/F239 : CA 3E F2                           JZ      CE_NEXT             ; No digits = don't modify
  549/F23C : 79                                 MOV     A,C                 ; Get the value from C
  550/F23D : 77                                 MOV     M,A                 ; Store it
  551/F23E :                                    
  552/F23E :                            CE_NEXT:
  553/F23E : 23                                 INX     H
  554/F23F : CD 80 F0                           CALL    PRINT_CRLF
  555/F242 : C3 1B F2                           JMP     CE_LOOP
  556/F245 :                                    
  557/F245 :                            CE_EXIT:
  558/F245 : 22 D4 00                           SHLD    LAST_EXAM_ADDR
  559/F248 : CD 80 F0                           CALL    PRINT_CRLF
  560/F24B : C3 0F F0                           JMP     MAIN_LOOP
  561/F24E :                                    
  562/F24E :                            CE_ERROR:
  563/F24E : 21 20 F3                           LXI     H,MSG_BAD_ADDR
  564/F251 : CD 76 F0                           CALL    PRINT_STRING
  565/F254 : C3 0F F0                           JMP     MAIN_LOOP
  566/F257 :                            
  567/F257 :                            ; CMD_GO - Execute at address
  568/F257 :                            ; Syntax: G [addr]
  569/F257 :                            ; If no address, defaults to 0100H (TPA)
  570/F257 :                            CMD_GO:
  571/F257 : CD 0A F1                           CALL    READ_HEX_WORD       ; Parse address into DE
  572/F25A : DA 5F F2                           JC      CG_DEFAULT          ; No address given
  573/F25D : EB                                 XCHG                        ; HL = parsed address
  574/F25E : E9                                 PCHL                        ; Jump and never return
  575/F25F :                                    
  576/F25F :                            CG_DEFAULT:
  577/F25F : 21 00 01                           LXI     H,0100H             ; Default to TPA
  578/F262 : E9                                 PCHL
  579/F263 :                            
  580/F263 :                            ; CMD_HELP - Show help
  581/F263 :                            CMD_HELP:
  582/F263 : 21 44 F3                           LXI     H,MSG_HELP
  583/F266 : CD 76 F0                           CALL    PRINT_STRING
  584/F269 : C3 0F F0                           JMP     MAIN_LOOP
  585/F26C :                            
  586/F26C :                            ; ============================================
  587/F26C :                            ; HELPER ROUTINES
  588/F26C :                            ; ============================================
  589/F26C :                            
  590/F26C :                            ; READ_EXAM_BYTE - Read byte value for examine command
  591/F26C :                            ; Reads up to 2 hex digits from console
  592/F26C :                            ; Output: Carry set = exit (period pressed)
  593/F26C :                            ;         Carry clear: B = digit count, C = value
  594/F26C :                            ;         (caller checks B: 0 = no modification, >0 = store C)
  595/F26C :                            ; Trashes: A, B, C, D, flags
  596/F26C :                            READ_EXAM_BYTE:
  597/F26C : 06 00                              MVI     B,0                 ; Digit count
  598/F26E : 0E 00                              MVI     C,0                 ; Accumulated value
  599/F270 :                                    
  600/F270 :                            REB_LOOP:
 AS V1.42 Beta [Bld 295] - Source File monitor.asm - Page 11 - 12/10/2025 19:16:31


  601/F270 : CD 5D F0                           CALL    CONIN
  602/F273 : 57                                 MOV     D,A                 ; Save original for echo
  603/F274 :                                    
  604/F274 : FE 2E                              CPI     '.'                 ; Exit?
  605/F276 : CA A0 F2                           JZ      REB_EXIT
  606/F279 : FE 0D                              CPI     CR                  ; Enter?
  607/F27B : CA 9E F2                           JZ      REB_DONE
  608/F27E : FE 08                              CPI     BS                  ; Backspace?
  609/F280 : CA A2 F2                           JZ      REB_BS
  610/F283 :                                    
  611/F283 : CD 3D F1                           CALL    TO_HEX_DIGIT        ; Convert to 0-15
  612/F286 : DA 70 F2                           JC      REB_LOOP            ; Not hex, ignore
  613/F289 :                                    
  614/F289 :                                    ; Valid hex digit in A
  615/F289 : F5                                 PUSH    PSW
  616/F28A : 79                                 MOV     A,C
  617/F28B : 87                                 ADD     A                   ; Shift left 4
  618/F28C : 87                                 ADD     A
  619/F28D : 87                                 ADD     A
  620/F28E : 87                                 ADD     A
  621/F28F : 4F                                 MOV     C,A
  622/F290 : F1                                 POP     PSW
  623/F291 : B1                                 ORA     C                   ; Add new digit
  624/F292 : 4F                                 MOV     C,A
  625/F293 :                                    
  626/F293 : 04                                 INR     B                   ; Count digit
  627/F294 : 7A                                 MOV     A,D                 ; Echo original char
  628/F295 : CD 51 F0                           CALL    CONOUT
  629/F298 :                                    
  630/F298 : 78                                 MOV     A,B
  631/F299 : FE 02                              CPI     2                   ; Two digits entered?
  632/F29B : DA 70 F2                           JC      REB_LOOP            ; No, keep reading
  633/F29E :                                    ; Fall through with 2 digits
  634/F29E :                                    
  635/F29E :                            REB_DONE:
  636/F29E :                                    ; Carry clear, B = digit count, C = value
  637/F29E : B7                                 ORA     A                   ; Clear carry
  638/F29F : C9                                 RET
  639/F2A0 :                                    
  640/F2A0 :                            REB_EXIT:
  641/F2A0 : 37                                 STC                         ; Set carry = exit
  642/F2A1 : C9                                 RET
  643/F2A2 :                                    
  644/F2A2 :                            REB_BS:
  645/F2A2 : 78                                 MOV     A,B
  646/F2A3 : B7                                 ORA     A
  647/F2A4 : CA 70 F2                           JZ      REB_LOOP            ; Nothing to delete
  648/F2A7 :                                    
  649/F2A7 : 05                                 DCR     B
  650/F2A8 : 79                                 MOV     A,C                 ; Undo the shift
  651/F2A9 : 0F                                 RRC
  652/F2AA : 0F                                 RRC
  653/F2AB : 0F                                 RRC
  654/F2AC : 0F                                 RRC
  655/F2AD : E6 0F                              ANI     0FH
  656/F2AF : 4F                                 MOV     C,A
  657/F2B0 :                                    
  658/F2B0 : 3E 08                              MVI     A,BS                ; Erase on screen
  659/F2B2 : CD 51 F0                           CALL    CONOUT
  660/F2B5 : 3E 20                              MVI     A,' '
 AS V1.42 Beta [Bld 295] - Source File monitor.asm - Page 12 - 12/10/2025 19:16:31


  661/F2B7 : CD 51 F0                           CALL    CONOUT
  662/F2BA : 3E 08                              MVI     A,BS
  663/F2BC : CD 51 F0                           CALL    CONOUT
  664/F2BF : C3 70 F2                           JMP     REB_LOOP
  665/F2C2 :                            
  666/F2C2 :                            ; ============================================
  667/F2C2 :                            ; STRINGS
  668/F2C2 :                            ; ============================================
  669/F2C2 :                            
  670/F2C2 :                            MSG_BANNER:
  671/F2C2 : 0D 0A                              DB      CR,LF
  672/F2C4 : 38 30 38 30 20 4D 6F 6E 69         DB      "8080 Monitor v0.1",CR,LF
      F2CD : 74 6F 72 20 76 30 2E 31 0D
      F2D6 : 0A                        
  673/F2D7 : 42 75 69 6C 74 3A 20 31 32         DB      'Built: ', DATE, ' ', TIME, CR, LF
      F2E0 : 2F 31 30 2F 32 30 32 35 20
      F2E9 : 31 39 3A 31 36 3A 33 31 0D
      F2F2 : 0A                        
  674/F2F3 : 52 65 61 64 79 2E 0D 0A            DB      "Ready.",CR,LF
  675/F2FB : 00                                 DB      0
  676/F2FC :                            
  677/F2FC :                            MSG_UNKNOWN:
  678/F2FC : 55 6E 6B 6E 6F 77 6E 20 63         DB      "Unknown command. Type ? for help.",CR,LF,0
      F305 : 6F 6D 6D 61 6E 64 2E 20 54
      F30E : 79 70 65 20 3F 20 66 6F 72
      F317 : 20 68 65 6C 70 2E 0D 0A 00
  679/F320 :                            
  680/F320 :                            MSG_BAD_ADDR:
  681/F320 : 49 6E 76 61 6C 69 64 20 61         DB      "Invalid address",CR,LF,0
      F329 : 64 64 72 65 73 73 0D 0A 00
  682/F332 :                            
  683/F332 :                            MSG_NOT_IMPL:
  684/F332 : 4E 6F 74 20 69 6D 70 6C 65         DB      "Not implemented",CR,LF,0
      F33B : 6D 65 6E 74 65 64 0D 0A 00
  685/F344 :                            
  686/F344 :                            MSG_HELP:
  687/F344 : 43 6F 6D 6D 61 6E 64 73 3A         DB      "Commands:",CR,LF
      F34D : 0D 0A                     
  688/F34F : 20 20 44 20 5B 73 74 61 72         DB      "  D [start] [end]  - Dump memory",CR,LF
      F358 : 74 5D 20 5B 65 6E 64 5D 20
      F361 : 20 2D 20 44 75 6D 70 20 6D
      F36A : 65 6D 6F 72 79 0D 0A      
  689/F371 : 20 20 45 20 5B 61 64 64 72         DB      "  E [addr]         - Examine/modify",CR,LF
      F37A : 5D 20 20 20 20 20 20 20 20
      F383 : 20 2D 20 45 78 61 6D 69 6E
      F38C : 65 2F 6D 6F 64 69 66 79 0D
      F395 : 0A                        
  690/F396 : 20 20 47 20 5B 61 64 64 72         DB      "  G [addr]         - Go (execute)",CR,LF
      F39F : 5D 20 20 20 20 20 20 20 20
      F3A8 : 20 2D 20 47 6F 20 28 65 78
      F3B1 : 65 63 75 74 65 29 0D 0A   
  691/F3B9 : 20 20 3F 20 20 20 20 20 20         DB      "  ?                - Help",CR,LF
      F3C2 : 20 20 20 20 20 20 20 20 20
      F3CB : 20 2D 20 48 65 6C 70 0D 0A
  692/F3D4 : 00                                 DB      0
  693/F3D5 :                            
  694/F3D5 :                            ; ============================================
  695/F3D5 :                            ; PADDING
  696/F3D5 :                            ; ============================================
  697/F3D5 :                            
 AS V1.42 Beta [Bld 295] - Source File monitor.asm - Page 13 - 12/10/2025 19:16:31


  698/F3D5 : =>FALSE                            IF      $ > 0FFFFH
  699/F3D5 :                                    ERROR   "ROM exceeds 4KB!"
  700/F3D5 : [698]                              ENDIF
  701/F3D5 :                            
  702/F3D5 :                                    END     COLD_START
 AS V1.42 Beta [Bld 295] - Source File monitor.asm - Page 14 - 12/10/2025 19:16:31


  Symbol Table (* = unused):
  --------------------------

*ARCHITECTURE :                                      "aarch64-apple-darwin" - |
 BS :                             8 - | *BUFFER_PTR :                   0D0 - |
*CASESENSITIVE :                  0 - |  CD_ASCII :                   0F1D5 C |
 CD_DONE :                    0F1FF C |  CD_DOT :                     0F1E0 C |
 CD_DUMP_RANGE :              0F1AB C |  CD_ERROR :                   0F1A2 C |
 CD_HEX_BYTE :                0F1BA C |  CD_LINE :                    0F1AC C |
 CD_NO_ARGS :                 0F188 C |  CD_NO_GAP :                  0F1CA C |
 CD_ONE_ARG :                 0F196 C |  CD_POP_ERROR :               0F1A1 C |
 CD_PRINT_CHAR :              0F1E2 C |  CE_ERROR :                   0F24E C |
 CE_EXIT :                    0F245 C |  CE_LOOP :                    0F21B C |
 CE_NEXT :                    0F23E C |  CE_USE_LAST :                0F218 C |
 CG_DEFAULT :                 0F25F C |  CMD_DUMP :                   0F167 C |
 CMD_EXAMINE :                0F206 C |  CMD_GO :                     0F257 C |
 CMD_HELP :                   0F263 C |  COLD_START :                 0F000 C |
 CONIN :                      0F05D C |  CONOUT :                     0F051 C |
 CONOUT_WAIT :                0F052 C |  CONSOLE_DATA_IN :                1 - |
 CONSOLE_DATA_OUT :               0 - |  CONSOLE_STATUS :                 2 - |
*CONST :                      0F067 C | *CONSTPI :        3.141592653589793 - |
 CR :                            0D - |  DATE :                "12/10/2025" - |
*FALSE :                          0 - | *FLOATMAX :      1.797693134866E308 - |
*HAS64 :                          1 - |  LAST_DUMP_ADDR :               0D2 - |
 LAST_EXAM_ADDR :               0D4 - |  LF :                            0A - |
 LINE_BUFFER :                   80 - |  LINE_LENGTH :                   50 - |
*LISTON :                         1 - | *MACEXP :                         7 - |
 MAIN_LOOP :                  0F00F C | *MOMCPU :                      8080 - |
*MOMCPUNAME :                "8080" - |  MSG_BAD_ADDR :               0F320 C |
 MSG_BANNER :                 0F2C2 C |  MSG_HELP :                   0F344 C |
*MSG_NOT_IMPL :               0F332 C |  MSG_UNKNOWN :                0F2FC C |
*NESTMAX :                      100 - |  NOT_LOWER :                  0F033 C |
 PHN_DIGIT :                  0F0A7 C |  PRINT_BANNER :               0F06F C |
 PRINT_CRLF :                 0F080 C |  PRINT_HEX_BYTE :             0F091 C |
 PRINT_HEX_NIBBLE :           0F09E C |  PRINT_HEX_WORD :             0F0AD C |
 PRINT_SPACE :                0F08B C |  PRINT_STRING :               0F076 C |
 READ_EXAM_BYTE :             0F26C C |  READ_HEX_WORD :              0F10A C |
 READ_LINE :                  0F0B6 C |  REB_BS :                     0F2A2 C |
 REB_DONE :                   0F29E C |  REB_EXIT :                   0F2A0 C |
 REB_LOOP :                   0F270 C | *RELAXED :                        0 - |
 RHW_DONE :                   0F137 C |  RHW_LOOP :                   0F112 C |
 RL_BACKSPACE :               0F0E3 C |  RL_DONE :                    0F0FC C |
 RL_LOOP :                    0F0BB C |  SKIP_SPACES :                0F102 C |
 SPACE :                         20 - |  STACK_TOP :                  0F000 - |
 THD_ALPHA :                  0F15D C |  THD_DIGIT :                  0F161 C |
 THD_FAIL :                   0F165 C |  TIME :                  "19:16:31" - |
 TO_HEX_DIGIT :               0F13D C | *TRUE :                           1 - |
*VERSION :                     142F - | *Z80SYNTAX :                      0 - |

     89 symbols
     18 unused symbols

 AS V1.42 Beta [Bld 295] - Source File monitor.asm - Page 15 - 12/10/2025 19:16:31


  Code Pages:
  ----------

STANDARD (0 changed characters)

1 code page

0.00 seconds assembly time

    702 lines source file
      2 passes
      0 errors
      0 warnings
